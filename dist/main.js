!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);var r=60,i=16;function n(e){return 4095&e}function a(e){return(3840&e)>>8}function h(e){return[(3840&e)>>8,255&e]}function o(e){return[(3840&e)>>8,(240&e)>>4]}var c=function(){function e(e,t,s){void 0===t&&(t=64),void 0===s&&(s=32);var n=this;this.memory=new Uint8Array(4096),this.registers=new Uint8Array(16),this.addressRegister=0,this.pc=512,this.sp=-1,this.stack=new Uint16Array(i),this.delayTimer=0,this.soundTimer=0,setInterval(function(){n.delayTimer-=1,n.soundTimer-=1},1e3/r),this.width=t,this.height=s,this.display=new Uint8Array(this.width*this.height),this.canvas=e,this.ctx=e.getContext("2d"),this.state="running",this.keys=new Uint8Array(16),this.keypressRegister=null,this._loadCharacters()}return e.prototype._loadCharacters=function(){for(var e=0,t=0,s=[[240,144,144,144,240],[32,96,32,32,112],[240,16,240,128,240],[240,16,240,16,240],[144,144,240,16,16],[240,128,240,16,240],[240,128,240,144,240],[240,16,32,64,64],[240,144,240,144,240],[240,144,240,16,240],[240,144,240,144,144],[224,144,224,144,224],[240,128,128,128,240],[224,144,144,144,224],[240,128,240,128,240],[240,128,240,128,128]];t<s.length;t++)for(var r=0,i=s[t];r<i.length;r++){var n=i[r];this.memory[e++]=n}},e.prototype.loadROMData=function(e){for(var t=0;t<e.length;++t)this.memory[this.pc+t]=e[t]},e.prototype.draw=function(){var e=this.canvas.width/this.width,t=this.canvas.height/this.height;this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white";for(var s=0;s<this.height;++s)for(var r=0;r<this.width;++r){var i=s*this.width+r;this.display[i]&&this.ctx.fillRect(r*e,s*t,e,t)}},e.prototype.executeInstruction=function(e){switch((61440&e)>>12){case 0:if(224===e)this.display=this.display.map(function(){return 0});else{if(238!==e)return console.error("Unknown instruction: "+e.toString(16)),"break";this.pc=this.stack[this.sp],this.sp-=1}break;case 1:this.pc=n(e);break;case 2:this.sp+=1,this.stack[this.sp]=this.pc,this.pc=n(e);break;case 3:var t=h(e),s=t[0],r=t[1];this.registers[s]===r&&(this.pc+=2);break;case 4:var i=h(e);s=i[0],r=i[1];this.registers[s]!==r&&(this.pc+=2);break;case 5:var c=o(e),u=c[0],d=c[1];this.registers[u]===this.registers[d]&&(this.pc+=2);break;case 6:var l=h(e);s=l[0],r=l[1];this.registers[s]=r;break;case 7:var g=h(e);s=g[0],r=g[1];this.registers[s]+=r;break;case 8:var f=o(e);u=f[0],d=f[1];switch(15&e){case 0:this.registers[u]=this.registers[d];break;case 1:this.registers[u]|=this.registers[d];break;case 2:this.registers[u]&=this.registers[d];break;case 3:this.registers[u]^=this.registers[d];break;case 4:var p=this.registers[u]+this.registers[d];this.registers[u]=p,this.registers[15]=p>255?1:0;break;case 5:var y=this.registers[u]>this.registers[d];this.registers[u]=this.registers[u]-this.registers[d],this.registers[15]=y?1:0;break;case 6:var v=1&this.registers[u];this.registers[u]>>=1,this.registers[15]=v;break;case 7:y=this.registers[d]>this.registers[u];this.registers[u]=this.registers[d]-this.registers[u],this.registers[15]=y?1:0;break;case 14:var k=128&this.registers[u];this.registers[u]<<=1,this.registers[15]=k?1:0;break;default:console.error("Unknown instruction: "+e.toString(16)),this.state="finished"}break;case 10:var b=n(e);this.addressRegister=b;break;case 12:var m=h(e);s=m[0],r=m[1];this.registers[s]=Math.floor(256*Math.random())&r;break;case 13:for(var w=function(e){return[(3840&e)>>8,(240&e)>>4,15&e]}(e),R=(u=w[0],d=w[1],w[2]),x=this.registers[u],S=this.registers[d],A=0;A<R;++A)for(var U=this.memory[this.addressRegister+A],C=0;C<8;++C){var E=(U&1<<7-C)>>7-C,O=(S+A)*this.width+(x+C);this.display[O]&&E&&(this.registers[15]=1),this.display[O]^=E?1:0}this.draw();break;case 14:s=a(e);switch(255&e){case 158:this.keys[this.registers[s]]&&(this.pc+=2);break;case 161:this.keys[this.registers[s]]||(this.pc+=2);break;default:console.error("Unknown instruction: "+e.toString(16)),this.state="finished"}break;case 15:s=a(e);switch(255&e){case 7:this.registers[s]=this.delayTimer;break;case 10:this.state="waitkeypress",this.keypressRegister=s;break;case 21:this.delayTimer=this.registers[s];break;case 24:this.soundTimer=this.registers[s];break;case 30:this.addressRegister+=this.registers[s],this.addressRegister&=65535;break;case 41:this.addressRegister=5*this.registers[s];break;case 51:for(var P=this.registers[s],T=2;T>=0;--T)this.memory[this.addressRegister+T]=P%10,P/=10;break;case 85:for(T=0;T<=s;++T)this.memory[this.addressRegister+T]=this.registers[T];break;case 101:for(T=0;T<=s;++T)this.registers[T]=this.memory[this.addressRegister+T];break;default:console.error("Unknown instruction: "+e.toString(16)),this.state="finished"}break;default:console.error("Unknown instruction: "+e.toString(16)),this.state="finished"}},e.prototype.keydown=function(e){this.keys[e]=1,"waitkeypress"==this.state&&(console.assert(null!==this.keypressRegister),this.registers[this.keypressRegister]=e)},e.prototype.keyup=function(e){this.keys[e]=0},e.prototype.cycle=function(){if("running"===this.state){var e=this.memory[this.pc]<<8|this.memory[this.pc+1];return this.pc+=2,this.executeInstruction(e)}},e}();new Promise(function(e,t){var s=document.createElement("input");s.type="file",document.body.appendChild(s),s.addEventListener("input",function(){var t=s.files[0];s.remove(),e(t)})}).then(function(e){return function(e){return new Promise(function(t,s){var r=new FileReader;r.addEventListener("load",function(){t(r.result)}),r.readAsArrayBuffer(e)})}(e)}).then(function(e){var t=document.createElement("canvas");t.width=640,t.height=320,document.body.appendChild(t);var s=new c(t),r=new Uint8Array(e);s.loadROMData(r);var i=function(e){return parseInt(e,16)};window.addEventListener("keydown",function(e){var t=i(e.key);isNaN(t)||s.keydown(t)}),window.addEventListener("keyup",function(e){var t=i(e.key);isNaN(t)||s.keyup(t)});var n=null,a=document.createElement("input");a.name="ips",a.type="range",a.min="0",a.value="1200",a.max="2500",document.body.appendChild(a);var h=document.createElement("label");h.setAttribute("for","ips"),h.textContent="Instructions Per Second ("+a.value+")",document.body.appendChild(h);var o=1/+a.value*1e3;a.addEventListener("input",function(){o=1/+a.value*1e3,h.textContent="Instructions Per Second ("+a.value+")"}),window.requestAnimationFrame(function e(t){if(null!==n)for(var r=(t-n)/o,i=0;i<r;++i)s.cycle();n=t,window.requestAnimationFrame(e)})})}]);
//# sourceMappingURL=main.js.map